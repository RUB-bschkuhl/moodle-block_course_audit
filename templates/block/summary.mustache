{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_course_audit/summary_results

    Template for displaying course audit summary results as a checklist.

    Context variables required for this template:
    * results - array of audit results. Each result object MUST have:
        * id - unique ID for the result
        * rulekey - machine name of the rule (used to generate lang string key)
        * rulecategory - category of the rule (e.g., action, hint)
        * status - string: "0" (todo) or "1" (done)
        * messages - ARRAY of string messages for details (JSON string from server MUST be parsed before passing to template)
        * targettype - type of target (e.g., section)
        * targetid - ID of the target
        * ruleNameDisplay - Display name of the rule

    Example context (json - NOTE: messages MUST be an array here):
    {{!
        auditid: 12
        id: 278
        isDone: false
        isTodo: true
        messages: Array [ "Keine Aktivitäten in diesem Abschnitt haben Abschlussbedingungen eingerichtet. Bitte fügen Sie Bedingungen hinzu, um einen Lernpfad zu erstellen." ]
        ruleNameDisplay: "Aktivitätsverbindungen"
        rulecategory: "action"
        rulekey: "section_has_connections"
        status: "0"
        targetid: 51
        targettype: "section"
    }}

<div class="block_course_audit-summary-container">
<div class="card shadow-sm">
    <div class="card-header">
      <div class="card-title">{{#str}}summary_heading, block_course_audit{{/str}}</div>
      <div class="card-subtitle">Last updated: {{timecreated}}</div>
        <button class="btn btn-sm btn-close btn-minimize" aria-label="{{#str}}close, block_course_audit{{/str}}"></button>
    </div>

    <div class="card-body">
    {{#hasResults}}
      <ul class="check-list">
        {{#results}}
        <li class="check-item">
          <div class="check-header">
            <span class="check-name">{{ruleNameDisplay}}</span>
            <span class="check-status">
              {{#isTodo}}
                <span class="status-icon status-failed">✗</span>
              {{/isTodo}}
              {{#isDone}}
                <span class="status-icon status-passed">✓</span>
              {{/isDone}}
            </span>
          </div>
          <div class="check-details">
            <div class="details-content">
                    <div class="collapse mt-3" id="details-{{id}}">
                        <div class="card card-body bg-light small border p-3">
                            <em class="text-muted small mt-2">({{rulekey}} - {{targettype}} {{targetid}})</em>
                        </div>
                    </div>
                    {{#messages}}
                    <p>{{.}}</p>
                    {{/messages}}
              <div class="attribute">
                <span class="attribute-label">rulekey:</span>
                <span class="attribute-value">{{rulekey}}</span>
              </div>
              
              <div class="attribute">
                <span class="attribute-label">targettype:</span>
                <span class="attribute-value">{{targettype}} {{targetid}}</span>
              </div>
            </div>
          </div>
        </li>
        {{/results}}
      </ul>
    {{/hasResults}}
    {{^hasResults}}
        <div class="p-3 text-center text-muted">
            {{#str}}noauditresults, block_course_audit{{/str}}
        </div>
    {{/hasResults}}
    </div>
    
    <div class="card-footer">
      <span>{{rulecount}} checks processed</span>
      <span>{{passedcount}} passed • {{failedcount}} failed</span>
    </div>
  </div>
</div>