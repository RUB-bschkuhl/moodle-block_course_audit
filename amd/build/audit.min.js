/**
 * Course audit module.
 *
 * @module     block_course_audit/audit
 * @copyright  2025 Bastian Schmidt-Kuhl <bastian.schmidt-kuhl@ruhr-uni-bochum.de>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_course_audit/audit",["jquery","core/modal","core/modal_events","core/str","core/ajax","core/templates","core/notification"],(function($,Modal,ModalEvents,Str,Ajax,Templates,Notification){let currentArrow=null,currentHighlight=null,floatingAnalysisList={},displayMode="block",loadedSectionData={};if(window.localStorage){const storedMode=localStorage.getItem("block_course_audit_display_mode");storedMode&&(displayMode=storedMode)}const updateModeToggleButton=function(){const stringKey="block"===displayMode?"inline_mode":"block_mode";Str.get_string(stringKey,"block_course_audit").then((function(str){$("#block-course-audit-toggle-mode").text(str)})).catch(Notification.exception)},showFloatingAnalysis=function(sectionNumber){if(null==sectionNumber)return;if(floatingAnalysisList[sectionNumber])return void floatingAnalysisList[sectionNumber].removeClass("d-none");const section=$("#section-"+sectionNumber);if(!section.length)return;const sectionId=section.data("sectionid");sectionId&&Ajax.call([{methodname:"block_course_audit_get_section_analysis",args:{sectionid:sectionId},done:function(data){loadedSectionData[sectionNumber]=data,renderFloatingAnalysis(data)},fail:Notification.exception}])},renderFloatingAnalysis=function(data){if(!data||!data.section_number)return;const sectionNumber=data.section_number,section=$("#section-"+sectionNumber);floatingAnalysisList[sectionNumber]?floatingAnalysisList[sectionNumber].removeClass("d-none"):Templates.render("block_course_audit/float/floating_analysis",data).then((function(html){console.log(html),section.after(html),floatingAnalysisList[sectionNumber]=$("#block-course-audit-floating-"+sectionNumber),initFloatingAnalysisHandlers(sectionNumber)})).catch(Notification.exception)},initFloatingAnalysisHandlers=function(sectionNumber){const floatingElement=floatingAnalysisList[sectionNumber];floatingElement.on("click",".toggle-minimize",(function(e){e.preventDefault(),e.stopPropagation();const isMinimized=floatingElement.hasClass("minimized"),iconElement=$(this).find("i");isMinimized?(floatingElement.removeClass("minimized"),iconElement.removeClass("fa-plus").addClass("fa-minus"),Str.get_string("minimize","block_course_audit").then((function(str){$(e.currentTarget).attr("title",str)})).catch(Notification.exception)):(floatingElement.addClass("minimized"),iconElement.removeClass("fa-minus").addClass("fa-plus"),Str.get_string("maximize","block_course_audit").then((function(str){$(e.currentTarget).attr("title",str)})).catch(Notification.exception))})),floatingElement.on("click",(function(e){$(e.target).closest(".toggle-minimize, .close-analysis").length||floatingElement.hasClass("minimized")&&(floatingElement.removeClass("minimized"),floatingElement.find(".toggle-minimize i").removeClass("fa-plus").addClass("fa-minus"),Str.get_string("minimize","block_course_audit").then((function(str){floatingElement.find(".toggle-minimize").attr("title",str)})).catch(Notification.exception))})),floatingElement.on("click",".close-analysis",(function(e){e.preventDefault(),e.stopPropagation(),floatingElement.addClass("d-none")}))},hideAllFloatingAnalysis=function(){for(const sectionNumber in floatingAnalysisList)Object.prototype.hasOwnProperty.call(floatingAnalysisList,sectionNumber)&&floatingAnalysisList[sectionNumber].addClass("d-none")},showAllFloatingAnalysis=function(){$(".section.main").each((function(){const sectionId=$(this).attr("id");if(sectionId&&sectionId.startsWith("section-")){const sectionNumber=sectionId.replace("section-","");console.log(sectionNumber),showFloatingAnalysis(sectionNumber)}}))};return{init:function(){const container=$("#block-course-audit");let currentPage=1;const totalPages=container.data("total-pages");if(container.length){const blockHeader=container.find(".card-header").first();Str.get_string("inline_mode","block_course_audit").then((function(str){const toggleButton=$("<button/>",{id:"block-course-audit-toggle-mode",class:"btn btn-sm btn-outline-secondary ml-2",text:str,title:""});return blockHeader.append(toggleButton),Str.get_string("toggle_analysis_view","block_course_audit")})).then((function(str){$("#block-course-audit-toggle-mode").attr("title",str)})).catch(Notification.exception),container.on("click","#block-course-audit-toggle-mode",(function(e){e.preventDefault(),displayMode="block"===displayMode?"inline":"block",window.localStorage&&localStorage.setItem("block_course_audit_display_mode",displayMode),"inline"===displayMode?($("#block-course-audit").addClass("d-none"),showAllFloatingAnalysis()):($("#block-course-audit").removeClass("d-none"),hideAllFloatingAnalysis()),updateModeToggleButton()}))}"inline"===displayMode&&(container.length&&container.addClass("d-none"),currentPage>1&&currentPage<totalPages&&showAllFloatingAnalysis()),container.off("click.pagination").on("click.pagination",".page-nav",(function(e){if(e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled"))return;const newPage="next"===$(this).data("direction")?Math.min(currentPage+1,totalPages):Math.max(currentPage-1,1);if(newPage!==currentPage){var _currentArrow3;if(currentArrow)null===(_currentArrow3=currentArrow)||void 0===_currentArrow3||_currentArrow3.remove(),currentArrow=null;"inline"===displayMode&&hideAllFloatingAnalysis(),$("#page-content-".concat(currentPage)).removeClass("d-block").addClass("d-none"),$("#page-content-".concat(newPage)).removeClass("d-none").addClass("d-block"),$("#current-page").text(newPage),$('[data-direction="prev"]').prop("disabled",newPage<=1),$('[data-direction="next"]').prop("disabled",newPage>=totalPages);const sectionNumber=$("#page-content-".concat(newPage)).data("section-number");(sectionNumber||0===sectionNumber)&&(!function(sectionNumber){const targetSection=$("#section-"+sectionNumber);var _currentArrow;if(currentArrow&&(null===(_currentArrow=currentArrow)||void 0===_currentArrow||_currentArrow.remove(),currentArrow=null),!targetSection.length)return;$("html, body").animate({scrollTop:targetSection.offset().top-100},800),targetSection.addClass("block-course-audit-highlight"),currentArrow=$('<div class="block-course-audit-arrow"><i class="fa fa-arrow-right fa-2x text-muted" aria-hidden="true"></i></div>'),$("body").append(currentArrow),(()=>{const rect=targetSection[0].getBoundingClientRect();currentArrow.css({left:rect.right+10,top:rect.top+window.scrollY+rect.height/2-25})})(),setTimeout((()=>{var _currentArrow2;targetSection.removeClass("block-course-audit-highlight"),null===(_currentArrow2=currentArrow)||void 0===_currentArrow2||_currentArrow2.remove(),currentArrow=null}),2e3)}(sectionNumber),function(sectionNumber){null!==currentHighlight&&$("#section-".concat(currentHighlight)).removeClass("block-course-audit-active-section"),(sectionNumber||0===sectionNumber)&&$("#section-"+sectionNumber).length&&(currentHighlight=sectionNumber,$("#section-".concat(sectionNumber)).addClass("block-course-audit-active-section"))}(sectionNumber),"inline"===displayMode&&showFloatingAnalysis(sectionNumber)),currentPage=newPage}})),$('[data-toggle="tooltip"]').tooltip({container:"body",boundary:"viewport"})}}}));

//# sourceMappingURL=audit.min.js.map