{"version":3,"file":"tour_creator.min.js","sources":["../src/tour_creator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for handling tour creation via button click.\n *\n * @module     block_course_audit/tour_creator\n * @copyright  2024 Your Name <your.email@example.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/config'], function ($, Ajax, Notification, Str, Config) {\n    /**\n     * Initialize the module.\n     *\n     * @param {int} courseId The course ID\n     */\n    const init = function (courseId) {\n        addMiauSprite();\n\n        $('.btn-minimize').on('click', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if ($('#bubble-container').is(\":visible\")) {\n                $('#miau-gif').removeClass('miau-talk');\n                $('#bubble-container').hide();\n            }\n        });\n\n        $('#audit-start').on('click', function (e) {\n            e.preventDefault();\n\n            // Show loading indicator\n            const $button = $(this);\n            const originalText = $button.text();\n            $button.prop('disabled', true);\n\n            Str.get_string('creatingtour', 'block_course_audit').then(function (loadingText) {\n                $button.text(loadingText);\n                return Ajax.call([{\n                    methodname: 'block_course_audit_create_tour',\n                    args: {\n                        courseid: courseId\n                    }\n                }])[0];\n            }).then(function (response) {\n                console.log(response);\n                return Str.get_string('toursuccess', 'block_course_audit');\n            }).then(function (successText) {\n                $button.text(successText);\n                // Reload the page after a short delay to start the tour\n                setTimeout(function () {\n                    window.location.reload();\n                }, 500);\n            }).catch(function (error) {\n                Notification.exception(error);\n                $button.text(originalText);\n                $button.prop('disabled', false);\n            });\n        });\n    };\n\n    const moveBlockToSprite = function () {\n        var $original = $('#block-course-audit');\n        var $copy = $original.clone();\n        $('#miau-speech-bubble').append($copy);\n        $copy.show();\n    };\n\n    const addMiauSprite = function () {\n        //TODO move to and load from mustache template\n        const $miauWrapper = $('<div>').attr({\n            'id': 'miau-wrapper',\n            'class': 'slide-in'\n        });\n\n        const $speechBubble = $('<div>').attr({\n            'id': 'miau-speech-bubble',\n            'aria-hidden': 'true'\n        });\n\n        const $miauContainer = $('<div>').attr({\n            'id': 'miau-gif',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'tabindex': '0'\n        });\n\n        const $bubbleContainer = $('<div>').attr({\n            'id': 'bubble-container',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'style': 'display: none;'\n        });\n\n        $speechBubble.append(\n            $('<div>').attr({ 'id': 'miau-speech-bubble-inner' })\n        );\n        $bubbleContainer.append($speechBubble);\n        $miauContainer.append($bubbleContainer);\n        $miauWrapper.append($miauContainer);\n        $('#page').append($miauWrapper);\n\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-wrapper').css('opacity', '1');\n            $('#miau-wrapper').removeClass('slide-in');\n        }, 2000);\n\n        moveBlockToSprite();\n\n        $miauWrapper.click(function () {\n            triggerTalkAnimation();\n            if (!$bubbleContainer.is(\":visible\")) {\n                $bubbleContainer.show();\n            }\n        });\n    };\n\n    const triggerTalkAnimation = function () {\n        $('#miau-gif').removeClass('miau-talk');\n        $('#miau-gif').addClass('miau-talk');\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-gif').removeClass('miau-talk');\n        }, 8000);\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","Config","addMiauSprite","$miauWrapper","attr","$speechBubble","$miauContainer","$bubbleContainer","$copy","append","setTimeout","css","removeClass","clone","show","click","triggerTalkAnimation","is","addClass","init","courseId","on","e","preventDefault","stopPropagation","hide","$button","this","originalText","text","prop","get_string","then","loadingText","call","methodname","args","courseid","response","console","log","successText","window","location","reload","catch","error","exception"],"mappings":";;;;;;;AAuBAA,yCAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,gBAAgB,SAAUC,EAAGC,KAAMC,aAAcC,IAAKC,cA0D5GC,cAAgB,iBAEZC,aAAeN,EAAE,SAASO,KAAK,IAC3B,qBACG,aAGPC,cAAgBR,EAAE,SAASO,KAAK,IAC5B,mCACS,SAGbE,eAAiBT,EAAE,SAASO,KAAK,IAC7B,yBACS,YACP,wBACI,MAGVG,iBAAmBV,EAAE,SAASO,KAAK,IAC/B,iCACS,YACP,qBACC,mBA9BS,IAElBI,MA+BJH,cAAcI,OACVZ,EAAE,SAASO,KAAK,IAAQ,8BAE5BG,iBAAiBE,OAAOJ,eACxBC,eAAeG,OAAOF,kBACtBJ,aAAaM,OAAOH,gBACpBT,EAAE,SAASY,OAAON,cAElBO,YAAW,WAEPb,EAAE,iBAAiBc,IAAI,UAAW,KAClCd,EAAE,iBAAiBe,YAAY,cAChC,KA3CCJ,MADYX,EAAE,uBACIgB,QACtBhB,EAAE,uBAAuBY,OAAOD,OAChCA,MAAMM,OA6CNX,aAAaY,OAAM,WACfC,uBACKT,iBAAiBU,GAAG,aACrBV,iBAAiBO,WAKvBE,qBAAuB,WACzBnB,EAAE,aAAae,YAAY,aAC3Bf,EAAE,aAAaqB,SAAS,aACxBR,YAAW,WAEPb,EAAE,aAAae,YAAY,eAC5B,YAGA,CACHO,KAhHS,SAAUC,UACnBlB,gBAEAL,EAAE,iBAAiBwB,GAAG,SAAS,SAAUC,GACrCA,EAAEC,iBACFD,EAAEE,kBACE3B,EAAE,qBAAqBoB,GAAG,cAC1BpB,EAAE,aAAae,YAAY,aAC3Bf,EAAE,qBAAqB4B,WAI/B5B,EAAE,gBAAgBwB,GAAG,SAAS,SAAUC,GACpCA,EAAEC,uBAGIG,QAAU7B,EAAE8B,MACZC,aAAeF,QAAQG,OAC7BH,QAAQI,KAAK,YAAY,GAEzB9B,IAAI+B,WAAW,eAAgB,sBAAsBC,MAAK,SAAUC,oBAChEP,QAAQG,KAAKI,aACNnC,KAAKoC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFC,SAAUjB,aAEd,MACLY,MAAK,SAAUM,iBACdC,QAAQC,IAAIF,UACLtC,IAAI+B,WAAW,cAAe,yBACtCC,MAAK,SAAUS,aACdf,QAAQG,KAAKY,aAEb/B,YAAW,WACPgC,OAAOC,SAASC,WACjB,QACJC,OAAM,SAAUC,OACf/C,aAAagD,UAAUD,OACvBpB,QAAQG,KAAKD,cACbF,QAAQI,KAAK,YAAY"}