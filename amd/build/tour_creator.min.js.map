{"version":3,"file":"tour_creator.min.js","sources":["../src/tour_creator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n/**\n* JavaScript for handling tour creation via button click.\n*\n* @module block_course_audit/tour_creator\n* @copyright 2024 Your Name <your.email@example.com>\n* @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/config'], function ($, Ajax, Notification, Str) {\n    /**\n    * Initialize the module.\n    *\n    * @param {int} courseId The course ID\n    */\n    const init = function (courseId) {\n        addMiauSprite();\n        $('.btn-minimize').on('click', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            hideBubble();\n        });\n        $('#audit-start').on('click', function (e) {\n            e.preventDefault();\n            // Show loading indicator\n            const $button = $(this);\n            const originalText = $button.text();\n            $button.prop('disabled', true);\n            Str.get_string('creatingtour', 'block_course_audit').then(function (loadingText) {\n                $button.text(loadingText);\n                return Ajax.call([{\n                    methodname: 'block_course_audit_create_tour',\n                    args: {\n                        courseid: courseId\n                    }\n                }])[0];\n            }).then(function (response) {\n                var tourdata = response.tourdata;\n                if (!tourdata || !response.status) {\n                    let errorMessage = response.message || 'Unknown error creating tour data.';\n                    console.error('Tour creation failed:', errorMessage);\n                    throw new Error(errorMessage);\n                }\n                if (response.status) {\n                    hideBubble();\n                    require(['tool_usertours/usertours'], function (usertours) {\n                        usertours.init(tourdata.tourDetails, tourdata.filterNames);\n                    });\n                    return Str.get_string('toursuccess', 'block_course_audit');\n                }\n            }).then(function (successText) {\n                $button.text(successText);\n            }).catch(function (error) {\n                Notification.exception(error);\n                $button.text(originalText);\n                $button.prop('disabled', false);\n            });\n        });\n    };\n    const moveBlockToSprite = function () {\n        var $block = $('#block-course-audit');\n        $('#miau-speech-bubble').append($block);\n        $block.show();\n    };\n    const hideBubble = function () {\n        if ($('#bubble-container').is(\":visible\")) {\n            $('#miau-gif').removeClass('miau-talk');\n            $('#bubble-container').hide();\n        }\n    };\n    const addMiauSprite = function () {\n        //TODO move to and load from mustache template\n        const $miauWrapper = $('<div>').attr({\n            'id': 'miau-wrapper',\n            'class': 'slide-in'\n        });\n        const $speechBubble = $('<div>').attr({\n            'id': 'miau-speech-bubble',\n            'aria-hidden': 'true'\n        });\n        const $miauContainer = $('<div>').attr({\n            'id': 'miau-gif',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'tabindex': '0'\n        });\n        const $bubbleContainer = $('<div>').attr({\n            'id': 'bubble-container',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'style': 'display: none;'\n        });\n        $speechBubble.append(\n            $('<div>').attr({ 'id': 'miau-speech-bubble-inner' })\n        );\n        $bubbleContainer.append($speechBubble);\n        $miauContainer.append($bubbleContainer);\n        $miauWrapper.append($miauContainer);\n        $('#page').append($miauWrapper);\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-wrapper').css('opacity', '1');\n            $('#miau-wrapper').removeClass('slide-in');\n        }, 2000);\n        moveBlockToSprite();\n        $miauWrapper.click(function () {\n            triggerTalkAnimation();\n            if (!$bubbleContainer.is(\":visible\")) {\n                $bubbleContainer.show();\n            }\n        });\n    };\n    const triggerTalkAnimation = function () {\n        $('#miau-gif').removeClass('miau-talk');\n        $('#miau-gif').addClass('miau-talk');\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-gif').removeClass('miau-talk');\n        }, 8000);\n    };\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","hideBubble","is","removeClass","hide","addMiauSprite","$miauWrapper","attr","$speechBubble","$miauContainer","$bubbleContainer","$block","append","setTimeout","css","show","click","triggerTalkAnimation","addClass","init","courseId","on","e","preventDefault","stopPropagation","$button","this","originalText","text","prop","get_string","then","loadingText","call","methodname","args","courseid","response","tourdata","status","errorMessage","message","console","error","Error","require","usertours","tourDetails","filterNames","successText","catch","exception"],"mappings":";;;;;;;AAqBAA,yCAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,gBAAgB,SAAUC,EAAGC,KAAMC,aAAcC,WAuDvGC,WAAa,WACXJ,EAAE,qBAAqBK,GAAG,cAC1BL,EAAE,aAAaM,YAAY,aAC3BN,EAAE,qBAAqBO,SAGzBC,cAAgB,iBAEZC,aAAeT,EAAE,SAASU,KAAK,IAC3B,qBACG,aAEPC,cAAgBX,EAAE,SAASU,KAAK,IAC5B,mCACS,SAEbE,eAAiBZ,EAAE,SAASU,KAAK,IAC7B,yBACS,YACP,wBACI,MAEVG,iBAAmBb,EAAE,SAASU,KAAK,IAC/B,iCACS,YACP,qBACC,mBA/BS,IAClBI,OAgCJH,cAAcI,OACVf,EAAE,SAASU,KAAK,IAAQ,8BAE5BG,iBAAiBE,OAAOJ,eACxBC,eAAeG,OAAOF,kBACtBJ,aAAaM,OAAOH,gBACpBZ,EAAE,SAASe,OAAON,cAClBO,YAAW,WAEPhB,EAAE,iBAAiBiB,IAAI,UAAW,KAClCjB,EAAE,iBAAiBM,YAAY,cAChC,KA3CCQ,OAASd,EAAE,uBACfA,EAAE,uBAAuBe,OAAOD,QAChCA,OAAOI,OA2CPT,aAAaU,OAAM,WACfC,uBACKP,iBAAiBR,GAAG,aACrBQ,iBAAiBK,WAIvBE,qBAAuB,WACzBpB,EAAE,aAAaM,YAAY,aAC3BN,EAAE,aAAaqB,SAAS,aACxBL,YAAW,WAEPhB,EAAE,aAAaM,YAAY,eAC5B,YAEA,CACHgB,KA1GS,SAAUC,UACnBf,gBACAR,EAAE,iBAAiBwB,GAAG,SAAS,SAAUC,GACrCA,EAAEC,iBACFD,EAAEE,kBACFvB,gBAEJJ,EAAE,gBAAgBwB,GAAG,SAAS,SAAUC,GACpCA,EAAEC,uBAEIE,QAAU5B,EAAE6B,MACZC,aAAeF,QAAQG,OAC7BH,QAAQI,KAAK,YAAY,GACzB7B,IAAI8B,WAAW,eAAgB,sBAAsBC,MAAK,SAAUC,oBAChEP,QAAQG,KAAKI,aACNlC,KAAKmC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFC,SAAUhB,aAEd,MACLW,MAAK,SAAUM,cACVC,SAAWD,SAASC,aACnBA,WAAaD,SAASE,OAAQ,KAC3BC,aAAeH,SAASI,SAAW,0CACvCC,QAAQC,MAAM,wBAAyBH,cACjC,IAAII,MAAMJ,iBAEhBH,SAASE,cACTtC,aACA4C,QAAQ,CAAC,6BAA6B,SAAUC,WAC5CA,UAAU3B,KAAKmB,SAASS,YAAaT,SAASU,gBAE3ChD,IAAI8B,WAAW,cAAe,yBAE1CC,MAAK,SAAUkB,aACdxB,QAAQG,KAAKqB,gBACdC,OAAM,SAAUP,OACf5C,aAAaoD,UAAUR,OACvBlB,QAAQG,KAAKD,cACbF,QAAQI,KAAK,YAAY"}