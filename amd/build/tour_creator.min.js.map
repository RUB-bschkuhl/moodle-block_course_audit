{"version":3,"file":"tour_creator.min.js","sources":["../src/tour_creator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n/**\n* JavaScript for handling tour creation via button click.\n*\n* @module block_course_audit/tour_creator\n* @copyright 2024 Your Name <your.email@example.com>\n* @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/config'], function ($, Ajax, Notification, Str) {\n\n    let speechBubble = null;\n    let miauContainer = null;\n    let bubbleContainer = null;\n    let speechBubbleInner = null;\n    let miauWrapper = null;\n\n    const getElements = function () {\n        miauWrapper = document.getElementById('miau-wrapper');\n        speechBubble = document.getElementById('miau-speech-bubble');\n        miauContainer = document.getElementById('miau-gif');\n        bubbleContainer = document.getElementById('bubble-container');\n        speechBubbleInner = document.getElementById('miau-speech-bubble-inner');\n\n        if (!miauWrapper || !speechBubble || !miauContainer || !bubbleContainer || !speechBubbleInner) {\n            console.error('Course Audit: Could not find one or more required sprite/bubble elements. Ensure templates are loaded.');\n        }\n    };\n\n    /**\n    * Initialize the module.\n    *\n    * @param {int} courseId The course ID\n    */\n    const init = function (courseId) {\n        getElements();\n\n        if (!miauWrapper) {\n            return;\n        }\n\n        addMiauSprite();\n\n        $(bubbleContainer).find('.btn-minimize').on('click', function (e) { // Assuming button is inside bubble\n            e.preventDefault();\n            e.stopPropagation();\n            hideBubble();\n        });\n        $('#audit-start').on('click', function (e) {\n            e.preventDefault();\n\n            const $button = $(this);\n            const originalText = $button.text();\n            $button.prop('disabled', true);\n            Str.get_string('creatingtour', 'block_course_audit').then(function (loadingText) {\n                $button.text(loadingText);\n\n                return Ajax.call([{\n                    methodname: 'block_course_audit_create_tour',\n                    args: {\n                        courseid: courseId\n                    }\n                }])[0];\n            }).then(function (response) {\n                var tourdata = response.tourdata;\n                if (!tourdata || !response.status) {\n                    let errorMessage = response.message || 'Unknown error creating tour data.';\n                    console.error('Tour creation failed:', errorMessage);\n                    throw new Error(errorMessage);\n                }\n                if (response.status) {\n                    hideBubble();\n                    // TODO use usertour external:\n                    // * @param   int     $tourid     The ID of the tour to fetch.\n                    // * @param   int     $context    The Context ID of the current page.\n                    // * @param   string  $pageurl    The path of the current page.\n                    // * @return  array               As described in fetch_and_start_tour_returns\n                    // */\n                    // public static function fetch_and_start_tour($tourid, $context, $pageurl) {\n                    // tool_usertours_fetch_and_start_tour\n\n                    // return Ajax.call([{\n                    //     methodname: 'tool_usertours_fetch_and_start_tour',\n                    //     args: {\n                    //     tourid,\n                    //     context: moodleConfig.contextid,\n                    //     pageurl: window.location.href,\n                    // }\n                    // }])[0];\n                    require(['tool_usertours/usertours'], function (usertours) {\n                        usertours.init(tourdata.tourDetails, tourdata.filterNames);\n                    });\n                    return Str.get_string('toursuccess', 'block_course_audit');\n                }\n            }).then(function (successText) {\n                $button.text(successText);\n            }).catch(function (error) {\n                Notification.exception(error);\n                $button.text(originalText);\n                $button.prop('disabled', false);\n            });\n        });\n    };\n    const moveBlockToSprite = function () {\n        // TODO rework\n        // if (!speechBubble) {\n        //     getElements();\n        // }\n        // if (speechBubble) {\n        //     var $block = $('#block-course-audit');\n        //     $(speechBubble).append($block);\n        //     $block.show();\n        // } else {\n        //     console.error('Course Audit: Cannot move block, speechBubble element not found.');\n        // }\n    };\n    const hideBubble = function () {\n        if (bubbleContainer && $(bubbleContainer).is(\":visible\")) {\n            $(miauContainer).removeClass('miau-talk');\n            $(bubbleContainer).hide();\n        }\n    };\n    const addMiauSprite = function () {\n        setTimeout(function () {\n            if (miauWrapper) {\n                $(miauWrapper).css('opacity', '1');\n                $(miauWrapper).removeClass('slide-in');\n            }\n        }, 2000);\n        moveBlockToSprite();\n        if (miauWrapper) {\n            $(miauWrapper).click(function () {\n                triggerTalkAnimation();\n                if (bubbleContainer && !$(bubbleContainer).is(\":visible\")) {\n                    $(bubbleContainer).show();\n                }\n            });\n        }\n    };\n    const triggerTalkAnimation = function () {\n        if (miauContainer) {\n            $(miauContainer).removeClass('miau-talk');\n            $(miauContainer).addClass('miau-talk');\n            setTimeout(function () {\n                $(miauContainer).removeClass('miau-talk');\n            }, 8000);\n        }\n    };\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","speechBubble","miauContainer","bubbleContainer","speechBubbleInner","miauWrapper","hideBubble","is","removeClass","hide","addMiauSprite","setTimeout","css","click","triggerTalkAnimation","show","addClass","init","courseId","document","getElementById","console","error","find","on","e","preventDefault","stopPropagation","$button","this","originalText","text","prop","get_string","then","loadingText","call","methodname","args","courseid","response","tourdata","status","errorMessage","message","Error","require","usertours","tourDetails","filterNames","successText","catch","exception"],"mappings":";;;;;;;AAsBAA,yCAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,gBAAgB,SAAUC,EAAGC,KAAMC,aAAcC,SAEzGC,aAAe,KACfC,cAAgB,KAChBC,gBAAkB,KAClBC,kBAAoB,KACpBC,YAAc,WAqGZC,WAAa,WACXH,iBAAmBN,EAAEM,iBAAiBI,GAAG,cACzCV,EAAEK,eAAeM,YAAY,aAC7BX,EAAEM,iBAAiBM,SAGrBC,cAAgB,WAClBC,YAAW,WACHN,cACAR,EAAEQ,aAAaO,IAAI,UAAW,KAC9Bf,EAAEQ,aAAaG,YAAY,eAEhC,KAECH,aACAR,EAAEQ,aAAaQ,OAAM,WACjBC,uBACIX,kBAAoBN,EAAEM,iBAAiBI,GAAG,aAC1CV,EAAEM,iBAAiBY,WAK7BD,qBAAuB,WACrBZ,gBACAL,EAAEK,eAAeM,YAAY,aAC7BX,EAAEK,eAAec,SAAS,aAC1BL,YAAW,WACPd,EAAEK,eAAeM,YAAY,eAC9B,aAGJ,CACHS,KAnHS,SAAUC,UAhBnBb,YAAcc,SAASC,eAAe,gBACtCnB,aAAekB,SAASC,eAAe,sBACvClB,cAAgBiB,SAASC,eAAe,YACxCjB,gBAAkBgB,SAASC,eAAe,oBAC1ChB,kBAAoBe,SAASC,eAAe,4BAEvCf,aAAgBJ,cAAiBC,eAAkBC,iBAAoBC,mBACxEiB,QAAQC,MAAM,0GAYbjB,cAILK,gBAEAb,EAAEM,iBAAiBoB,KAAK,iBAAiBC,GAAG,SAAS,SAAUC,GAC3DA,EAAEC,iBACFD,EAAEE,kBACFrB,gBAEJT,EAAE,gBAAgB2B,GAAG,SAAS,SAAUC,GACpCA,EAAEC,uBAEIE,QAAU/B,EAAEgC,MACZC,aAAeF,QAAQG,OAC7BH,QAAQI,KAAK,YAAY,GACzBhC,IAAIiC,WAAW,eAAgB,sBAAsBC,MAAK,SAAUC,oBAChEP,QAAQG,KAAKI,aAENrC,KAAKsC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFC,SAAUrB,aAEd,MACLgB,MAAK,SAAUM,cACVC,SAAWD,SAASC,aACnBA,WAAaD,SAASE,OAAQ,KAC3BC,aAAeH,SAASI,SAAW,0CACvCvB,QAAQC,MAAM,wBAAyBqB,cACjC,IAAIE,MAAMF,iBAEhBH,SAASE,cACTpC,aAkBAwC,QAAQ,CAAC,6BAA6B,SAAUC,WAC5CA,UAAU9B,KAAKwB,SAASO,YAAaP,SAASQ,gBAE3CjD,IAAIiC,WAAW,cAAe,yBAE1CC,MAAK,SAAUgB,aACdtB,QAAQG,KAAKmB,gBACdC,OAAM,SAAU7B,OACfvB,aAAaqD,UAAU9B,OACvBM,QAAQG,KAAKD,cACbF,QAAQI,KAAK,YAAY"}