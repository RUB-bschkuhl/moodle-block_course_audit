{"version":3,"file":"tour_creator.min.js","sources":["../src/tour_creator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for handling tour creation via button click.\n *\n * @module     block_course_audit/tour_creator\n * @copyright  2024 Your Name <your.email@example.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/config'], function ($, Ajax, Notification, Str) {\n    /**\n     * Initialize the module.\n     *\n     * @param {int} courseId The course ID\n     */\n    const init = function (courseId) {\n        addMiauSprite();\n\n        $('.btn-minimize').on('click', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if ($('#bubble-container').is(\":visible\")) {\n                $('#miau-gif').removeClass('miau-talk');\n                $('#bubble-container').hide();\n            }\n        });\n\n        $('#audit-start').on('click', function (e) {\n            e.preventDefault();\n\n            // Show loading indicator\n            const $button = $(this);\n            const originalText = $button.text();\n            $button.prop('disabled', true);\n\n            Str.get_string('creatingtour', 'block_course_audit').then(function (loadingText) {\n                $button.text(loadingText);\n                return Ajax.call([{\n                    methodname: 'block_course_audit_create_tour',\n                    args: {\n                        courseid: courseId\n                    }\n                }])[0];\n            }).then(function (response) {\n                var tourdata = response.tourdata;\n                console.log('Extracted tourdata:', tourdata);\n\n                if (!tourdata || !response.status) {\n                    let errorMessage = response.message || 'Unknown error creating tour data.';\n                    console.error('Tour creation failed:', errorMessage);\n                    throw new Error(errorMessage);\n                }\n\n                if (response.status) {\n                    // Now you can use the tourdata object directly\n                    console.log('Tour Details:', tourdata.tourDetails);\n                    console.log('Filter Names:', tourdata.filterNames);\n\n                    require(['tool_usertours/usertours'], function (usertours) {\n                        usertours.init(tourdata.tourDetails, tourdata.filterNames);\n                    });\n\n\n                    return Str.get_string('toursuccess', 'block_course_audit');\n                }\n            }).then(function (successText) {\n                $button.text(successText);\n            }).catch(function (error) {\n                Notification.exception(error);\n                $button.text(originalText);\n                $button.prop('disabled', false);\n            });\n        });\n    };\n\n    const moveBlockToSprite = function () {\n        var $block = $('#block-course-audit');\n        // var $copy = $original.clone();\n        $('#miau-speech-bubble').append($block);\n        $block.show();\n    };\n\n    const addMiauSprite = function () {\n        //TODO move to and load from mustache template\n        const $miauWrapper = $('<div>').attr({\n            'id': 'miau-wrapper',\n            'class': 'slide-in'\n        });\n\n        const $speechBubble = $('<div>').attr({\n            'id': 'miau-speech-bubble',\n            'aria-hidden': 'true'\n        });\n\n        const $miauContainer = $('<div>').attr({\n            'id': 'miau-gif',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'tabindex': '0'\n        });\n\n        const $bubbleContainer = $('<div>').attr({\n            'id': 'bubble-container',\n            'aria-hidden': 'true',\n            'role': 'presentation',\n            'style': 'display: none;'\n        });\n\n        $speechBubble.append(\n            $('<div>').attr({ 'id': 'miau-speech-bubble-inner' })\n        );\n        $bubbleContainer.append($speechBubble);\n        $miauContainer.append($bubbleContainer);\n        $miauWrapper.append($miauContainer);\n        $('#page').append($miauWrapper);\n\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-wrapper').css('opacity', '1');\n            $('#miau-wrapper').removeClass('slide-in');\n        }, 2000);\n\n        moveBlockToSprite();\n\n        $miauWrapper.click(function () {\n            triggerTalkAnimation();\n            if (!$bubbleContainer.is(\":visible\")) {\n                $bubbleContainer.show();\n            }\n        });\n    };\n\n    const triggerTalkAnimation = function () {\n        $('#miau-gif').removeClass('miau-talk');\n        $('#miau-gif').addClass('miau-talk');\n        setTimeout(function () {\n            //Consider Animation time\n            $('#miau-gif').removeClass('miau-talk');\n        }, 8000);\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","addMiauSprite","$miauWrapper","attr","$speechBubble","$miauContainer","$bubbleContainer","$block","append","setTimeout","css","removeClass","show","click","triggerTalkAnimation","is","addClass","init","courseId","on","e","preventDefault","stopPropagation","hide","$button","this","originalText","text","prop","get_string","then","loadingText","call","methodname","args","courseid","response","tourdata","console","log","status","errorMessage","message","error","Error","tourDetails","filterNames","require","usertours","successText","catch","exception"],"mappings":";;;;;;;AAuBAA,yCAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,gBAAgB,SAAUC,EAAGC,KAAMC,aAAcC,WAyEvGC,cAAgB,iBAEZC,aAAeL,EAAE,SAASM,KAAK,IAC3B,qBACG,aAGPC,cAAgBP,EAAE,SAASM,KAAK,IAC5B,mCACS,SAGbE,eAAiBR,EAAE,SAASM,KAAK,IAC7B,yBACS,YACP,wBACI,MAGVG,iBAAmBT,EAAE,SAASM,KAAK,IAC/B,iCACS,YACP,qBACC,mBA9BS,IAClBI,OAgCJH,cAAcI,OACVX,EAAE,SAASM,KAAK,IAAQ,8BAE5BG,iBAAiBE,OAAOJ,eACxBC,eAAeG,OAAOF,kBACtBJ,aAAaM,OAAOH,gBACpBR,EAAE,SAASW,OAAON,cAElBO,YAAW,WAEPZ,EAAE,iBAAiBa,IAAI,UAAW,KAClCb,EAAE,iBAAiBc,YAAY,cAChC,KA5CCJ,OAASV,EAAE,uBAEfA,EAAE,uBAAuBW,OAAOD,QAChCA,OAAOK,OA6CPV,aAAaW,OAAM,WACfC,uBACKR,iBAAiBS,GAAG,aACrBT,iBAAiBM,WAKvBE,qBAAuB,WACzBjB,EAAE,aAAac,YAAY,aAC3Bd,EAAE,aAAamB,SAAS,aACxBP,YAAW,WAEPZ,EAAE,aAAac,YAAY,eAC5B,YAGA,CACHM,KA/HS,SAAUC,UACnBjB,gBAEAJ,EAAE,iBAAiBsB,GAAG,SAAS,SAAUC,GACrCA,EAAEC,iBACFD,EAAEE,kBACEzB,EAAE,qBAAqBkB,GAAG,cAC1BlB,EAAE,aAAac,YAAY,aAC3Bd,EAAE,qBAAqB0B,WAI/B1B,EAAE,gBAAgBsB,GAAG,SAAS,SAAUC,GACpCA,EAAEC,uBAGIG,QAAU3B,EAAE4B,MACZC,aAAeF,QAAQG,OAC7BH,QAAQI,KAAK,YAAY,GAEzB5B,IAAI6B,WAAW,eAAgB,sBAAsBC,MAAK,SAAUC,oBAChEP,QAAQG,KAAKI,aACNjC,KAAKkC,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFC,SAAUjB,aAEd,MACLY,MAAK,SAAUM,cACVC,SAAWD,SAASC,YACxBC,QAAQC,IAAI,sBAAuBF,WAE9BA,WAAaD,SAASI,OAAQ,KAC3BC,aAAeL,SAASM,SAAW,0CACvCJ,QAAQK,MAAM,wBAAyBF,cACjC,IAAIG,MAAMH,iBAGhBL,SAASI,cAETF,QAAQC,IAAI,gBAAiBF,SAASQ,aACtCP,QAAQC,IAAI,gBAAiBF,SAASS,aAEtCC,QAAQ,CAAC,6BAA6B,SAAUC,WAC5CA,UAAU/B,KAAKoB,SAASQ,YAAaR,SAASS,gBAI3C9C,IAAI6B,WAAW,cAAe,yBAE1CC,MAAK,SAAUmB,aACdzB,QAAQG,KAAKsB,gBACdC,OAAM,SAAUP,OACf5C,aAAaoD,UAAUR,OACvBnB,QAAQG,KAAKD,cACbF,QAAQI,KAAK,YAAY"}