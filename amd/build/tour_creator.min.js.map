{"version":3,"file":"tour_creator.min.js","sources":["../src/tour_creator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n/**\n* JavaScript for handling tour creation via button click.\n*\n* @module block_course_audit/tour_creator\n* @copyright 2024 Your Name <your.email@example.com>\n* @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\n\ndefine(['jquery', 'core/ajax', 'core/str', 'tool_usertours/events'],\n    function ($, Ajax, Str, userTourEventsModule) {\n\n        let speechBubble = null;\n        let miauContainer = null;\n        let bubbleContainer = null;\n        let speechBubbleInner = null;\n        let miauWrapper = null;\n\n        const getElements = function () {\n            miauWrapper = document.getElementById('miau-wrapper');\n            speechBubble = document.getElementById('miau-speech-bubble');\n            miauContainer = document.getElementById('miau-gif');\n            bubbleContainer = document.getElementById('bubble-container');\n            speechBubbleInner = document.getElementById('miau-speech-bubble-inner');\n\n            if (!miauWrapper || !speechBubble || !miauContainer || !bubbleContainer || !speechBubbleInner) {\n                console.error('Course Audit: Could not find one or more required elements. Ensure templates are loaded.');\n            }\n        };\n\n        /**\n        * Initialize the module.\n        *\n        * @param {int} courseId The course ID\n        */\n        const init = function (courseId) {\n            getElements();\n            if (!miauWrapper) {\n                return;\n            }\n\n            addMiauSprite();\n\n            $(bubbleContainer).find('.btn-minimize').on('click', function (e) {\n                e.preventDefault();\n                e.stopPropagation();\n                hideBubble();\n            });\n\n            $('#audit-start').on('click', function (e) {\n                e.preventDefault();\n\n                const $button = $(this);\n                const originalText = $button.text();\n                $button.prop('disabled', true);\n                Str.get_string('creatingtour', 'block_course_audit').then(function (loadingText) {\n                    $button.text(loadingText);\n                    return Ajax.call([{\n                        methodname: 'block_course_audit_create_tour',\n                        args: {\n                            courseid: courseId\n                        }\n                    }])[0];\n                }).then(function (response) {\n                    var tourData = response.tourdata;\n                    console.log(tourData);\n                    if (!tourData || !response.status) {\n                        let errorMessage = response.message || 'Unknown error creating tour data.';\n                        throw new Error(errorMessage);\n                    }\n                    if (response.status) {\n                        hideBubble();\n                        require(['tool_usertours/usertours'], function (usertours) {\n                            usertours.init(tourData.tourDetails, tourData.filterNames);\n                        });\n                        return Str.get_string('toursuccess', 'block_course_audit');\n                    }\n                }).then(function (succesText) {\n                    $button.text(succesText);\n                }).catch(function (errors) {\n                    console.error(errors);\n                    $button.text(originalText);\n                    $button.prop('disabled', false);\n                });\n            });\n\n            listenForTourEnd();\n        };\n\n        // Function to set up the event listener\n        const listenForTourEnd = function () {\n            const userTourEvents = userTourEventsModule.eventTypes;\n            document.addEventListener(userTourEvents.tourEnded, startTourSummary);\n            // You can also listen to other events like stepRender using the same pattern:\n            document.addEventListener(userTourEvents.stepRender, e => {\n                console.log('User Tour Step Render:', e.detail.tour); // The Tour instance\n            });\n        };\n\n        const startTourSummary = function () {\n            console.log(\"tour ended, start summary\");\n            // TODO: start summary\n        }\n        \n        const moveBlockToSprite = function () {\n            // TODO rework\n            // if (!speechBubble) {\n            //     getElements();\n            // }\n            // if (speechBubble) {\n            //     var $block = $('#block-course-audit');\n            //     $(speechBubble).append($block);\n            //     $block.show();\n            // } else {\n            //     console.error('Course Audit: Cannot move block, speechBubble element not found.');\n            // }\n        };\n        const hideBubble = function () {\n            if (bubbleContainer && $(bubbleContainer).is(\":visible\")) {\n                $(miauContainer).removeClass('miau-talk');\n                $(bubbleContainer).hide();\n            }\n        };\n        const addMiauSprite = function () {\n            setTimeout(function () {\n                if (miauWrapper) {\n                    $(miauWrapper).css('opacity', '1');\n                    $(miauWrapper).removeClass('slide-in');\n                }\n            }, 2000);\n            moveBlockToSprite();\n            if (miauWrapper) {\n                $(miauWrapper).click(function () {\n                    triggerTalkAnimation();\n                    if (bubbleContainer && !$(bubbleContainer).is(\":visible\")) {\n                        $(bubbleContainer).show();\n                    }\n                });\n            }\n        };\n        const triggerTalkAnimation = function () {\n            if (miauContainer) {\n                $(miauContainer).removeClass('miau-talk');\n                $(miauContainer).addClass('miau-talk');\n                setTimeout(function () {\n                    $(miauContainer).removeClass('miau-talk');\n                }, 8000);\n            }\n        };\n        return {\n            init: init\n        };\n    });"],"names":["define","$","Ajax","Str","userTourEventsModule","speechBubble","miauContainer","bubbleContainer","speechBubbleInner","miauWrapper","listenForTourEnd","userTourEvents","eventTypes","document","addEventListener","tourEnded","startTourSummary","stepRender","e","console","log","detail","tour","hideBubble","is","removeClass","hide","addMiauSprite","setTimeout","css","click","triggerTalkAnimation","show","addClass","init","courseId","getElementById","error","find","on","preventDefault","stopPropagation","$button","this","originalText","text","prop","get_string","then","loadingText","call","methodname","args","courseid","response","tourData","tourdata","status","errorMessage","message","Error","require","usertours","tourDetails","filterNames","succesText","catch","errors"],"mappings":";;;;;;;AAsBAA,yCAAO,CAAC,SAAU,YAAa,WAAY,0BACvC,SAAUC,EAAGC,KAAMC,IAAKC,0BAEhBC,aAAe,KACfC,cAAgB,KAChBC,gBAAkB,KAClBC,kBAAoB,KACpBC,YAAc,WA0EZC,iBAAmB,iBACfC,eAAiBP,qBAAqBQ,WAC5CC,SAASC,iBAAiBH,eAAeI,UAAWC,kBAEpDH,SAASC,iBAAiBH,eAAeM,YAAYC,IACjDC,QAAQC,IAAI,yBAA0BF,EAAEG,OAAOC,UAIjDN,iBAAmB,WACrBG,QAAQC,IAAI,8BAiBVG,WAAa,WACXhB,iBAAmBN,EAAEM,iBAAiBiB,GAAG,cACzCvB,EAAEK,eAAemB,YAAY,aAC7BxB,EAAEM,iBAAiBmB,SAGrBC,cAAgB,WAClBC,YAAW,WACHnB,cACAR,EAAEQ,aAAaoB,IAAI,UAAW,KAC9B5B,EAAEQ,aAAagB,YAAY,eAEhC,KAEChB,aACAR,EAAEQ,aAAaqB,OAAM,WACjBC,uBACIxB,kBAAoBN,EAAEM,iBAAiBiB,GAAG,aAC1CvB,EAAEM,iBAAiByB,WAK7BD,qBAAuB,WACrBzB,gBACAL,EAAEK,eAAemB,YAAY,aAC7BxB,EAAEK,eAAe2B,SAAS,aAC1BL,YAAW,WACP3B,EAAEK,eAAemB,YAAY,eAC9B,aAGJ,CACHS,KAnHS,SAAUC,UAhBnB1B,YAAcI,SAASuB,eAAe,gBACtC/B,aAAeQ,SAASuB,eAAe,sBACvC9B,cAAgBO,SAASuB,eAAe,YACxC7B,gBAAkBM,SAASuB,eAAe,oBAC1C5B,kBAAoBK,SAASuB,eAAe,4BAEvC3B,aAAgBJ,cAAiBC,eAAkBC,iBAAoBC,mBACxEW,QAAQkB,MAAM,4FAWb5B,cAILkB,gBAEA1B,EAAEM,iBAAiB+B,KAAK,iBAAiBC,GAAG,SAAS,SAAUrB,GAC3DA,EAAEsB,iBACFtB,EAAEuB,kBACFlB,gBAGJtB,EAAE,gBAAgBsC,GAAG,SAAS,SAAUrB,GACpCA,EAAEsB,uBAEIE,QAAUzC,EAAE0C,MACZC,aAAeF,QAAQG,OAC7BH,QAAQI,KAAK,YAAY,GACzB3C,IAAI4C,WAAW,eAAgB,sBAAsBC,MAAK,SAAUC,oBAChEP,QAAQG,KAAKI,aACN/C,KAAKgD,KAAK,CAAC,CACdC,WAAY,iCACZC,KAAM,CACFC,SAAUlB,aAEd,MACLa,MAAK,SAAUM,cACVC,SAAWD,SAASE,YACxBrC,QAAQC,IAAImC,WACPA,WAAaD,SAASG,OAAQ,KAC3BC,aAAeJ,SAASK,SAAW,0CACjC,IAAIC,MAAMF,iBAEhBJ,SAASG,cACTlC,aACAsC,QAAQ,CAAC,6BAA6B,SAAUC,WAC5CA,UAAU5B,KAAKqB,SAASQ,YAAaR,SAASS,gBAE3C7D,IAAI4C,WAAW,cAAe,yBAE1CC,MAAK,SAAUiB,YACdvB,QAAQG,KAAKoB,eACdC,OAAM,SAAUC,QACfhD,QAAQkB,MAAM8B,QACdzB,QAAQG,KAAKD,cACbF,QAAQI,KAAK,YAAY,SAIjCpC"}