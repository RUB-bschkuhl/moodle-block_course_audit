/**
* JavaScript for handling tour creation via button click.
*
* @module block_course_audit/tour_creator
* @copyright 2024 Your Name <your.email@example.com>
* @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
define("block_course_audit/tour_creator",["jquery","core/ajax","core/notification","core/str","core/config"],(function($,Ajax,Notification,Str){let speechBubble=null,miauContainer=null,bubbleContainer=null,speechBubbleInner=null,miauWrapper=null;const hideBubble=function(){bubbleContainer&&$(bubbleContainer).is(":visible")&&($(miauContainer).removeClass("miau-talk"),$(bubbleContainer).hide())},addMiauSprite=function(){setTimeout((function(){miauWrapper&&($(miauWrapper).css("opacity","1"),$(miauWrapper).removeClass("slide-in"))}),2e3),miauWrapper&&$(miauWrapper).click((function(){triggerTalkAnimation(),bubbleContainer&&!$(bubbleContainer).is(":visible")&&$(bubbleContainer).show()}))},triggerTalkAnimation=function(){miauContainer&&($(miauContainer).removeClass("miau-talk"),$(miauContainer).addClass("miau-talk"),setTimeout((function(){$(miauContainer).removeClass("miau-talk")}),8e3))};return{init:function(courseId){miauWrapper=document.getElementById("miau-wrapper"),speechBubble=document.getElementById("miau-speech-bubble"),miauContainer=document.getElementById("miau-gif"),bubbleContainer=document.getElementById("bubble-container"),speechBubbleInner=document.getElementById("miau-speech-bubble-inner"),miauWrapper&&speechBubble&&miauContainer&&bubbleContainer&&speechBubbleInner||console.error("Course Audit: Could not find one or more required sprite/bubble elements. Ensure templates are loaded."),miauWrapper&&(addMiauSprite(),$(bubbleContainer).find(".btn-minimize").on("click",(function(e){e.preventDefault(),e.stopPropagation(),hideBubble()})),$("#audit-start").on("click",(function(e){e.preventDefault();const $button=$(this),originalText=$button.text();$button.prop("disabled",!0),Str.get_string("creatingtour","block_course_audit").then((function(loadingText){return $button.text(loadingText),Ajax.call([{methodname:"block_course_audit_create_tour",args:{courseid:courseId}}])[0]})).then((function(response){var tourdata=response.tourdata;if(!tourdata||!response.status){let errorMessage=response.message||"Unknown error creating tour data.";throw console.error("Tour creation failed:",errorMessage),new Error(errorMessage)}if(response.status)return hideBubble(),require(["tool_usertours/usertours"],(function(usertours){usertours.init(tourdata.tourDetails,tourdata.filterNames)})),Str.get_string("toursuccess","block_course_audit")})).then((function(successText){$button.text(successText)})).catch((function(error){Notification.exception(error),$button.text(originalText),$button.prop("disabled",!1)}))})))}}}));

//# sourceMappingURL=tour_creator.min.js.map