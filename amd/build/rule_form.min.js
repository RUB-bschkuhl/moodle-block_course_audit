define("block_course_audit/rule_form",["jquery","core/log"],(function($,log){var SELECTORS_RULE_SET_ID='select[name="rulesetid"]',SELECTORS_NEW_RULE_SET_NAME='input[name="newrulesetname"]',SELECTORS_NEW_RULE_SET_DESCRIPTION='textarea[name="newrulesetdescription"]',SELECTORS_SEGMENT_WRAPPER=".conditionsegment-wrapper",SELECTORS_TARGET_TYPE='select[name^="chain_"][name$="_target_type"]',SELECTORS_TARGET_IDENTIFIER='input[name^="chain_"][name$="_target_identifier"]',SELECTORS_CHECK_TYPE='select[name^="chain_"][name$="_check_type"]',SELECTORS_CONTENT_CHILD_TYPE='select[name^="chain_"][name$="_content_child_type"]',SELECTORS_CONTENT_CHILD_IDENTIFIER='input[name^="chain_"][name$="_content_child_identifier"]',SELECTORS_SETTING_NAME='input[name^="chain_"][name$="_setting_name"]',SELECTORS_SETTING_OPERATOR='select[name^="chain_"][name$="_setting_operator"]',SELECTORS_SETTING_EXPECTED_VALUE='input[name^="chain_"][name$="_setting_expected_value"]',SELECTORS_ACTION_WRAPPER=".action-wrapper",SELECTORS_ACTION_TYPE='select[name^="action_"][name$="_type"]',SELECTORS_ACTION_CHANGE_SETTING_NAME='input[name^="action_"][name$="_change_setting_name"]',SELECTORS_ACTION_CHANGE_SETTING_NEW_VALUE='input[name^="action_"][name$="_change_setting_new_value"]',SELECTORS_ACTION_ADD_CONTENT_CHILD_TYPE='select[name^="action_"][name$="_add_content_child_type"]',SELECTORS_ACTION_ADD_CONTENT_CHILD_IDENTIFIER='input[name^="action_"][name$="_add_content_child_identifier"]',SELECTORS_ACTION_ADD_CONTENT_INITIAL_SETTINGS='textarea[name^="action_"][name$="_add_content_initial_settings"]',SELECTORS_ADD_SEGMENT_BUTTON_PREFIX='button[name^="add_segment_to_chain_"]',SELECTORS_ADD_CHAIN_BUTTON='button[name="add_condition_chain"]',SELECTORS_ADD_ACTION_BUTTON='button[name="add_failure_action"]',form=null;const getField=function(selector,baseElement){return baseElement?baseElement.find(selector):form.find(selector)},getFieldRow=function(selector,baseElement){return getField(selector,baseElement).closest(".fitem, .form-group")},toggleRuleSetFields=function(){var ruleSetId=getField(SELECTORS_RULE_SET_ID).val(),$newNameField=getField(SELECTORS_NEW_RULE_SET_NAME),$newDescField=getField(SELECTORS_NEW_RULE_SET_DESCRIPTION);"0"===ruleSetId?($newNameField.prop("disabled",!1),$newDescField.prop("disabled",!1),getFieldRow(SELECTORS_NEW_RULE_SET_NAME).show(),getFieldRow(SELECTORS_NEW_RULE_SET_DESCRIPTION).show()):($newNameField.prop("disabled",!0),$newDescField.prop("disabled",!0),getFieldRow(SELECTORS_NEW_RULE_SET_NAME).hide(),getFieldRow(SELECTORS_NEW_RULE_SET_DESCRIPTION).hide())},toggleSegmentFields=function(segmentWrapper){var $segment=$(segmentWrapper),targetType=getField(SELECTORS_TARGET_TYPE,$segment).val(),checkType=getField(SELECTORS_CHECK_TYPE,$segment).val(),$targetIdentifierRow=getFieldRow(SELECTORS_TARGET_IDENTIFIER,$segment);"MODULE"===targetType||"SUB_ELEMENT"===targetType?$targetIdentifierRow.show():$targetIdentifierRow.hide();var $contentChildTypeRow=getFieldRow(SELECTORS_CONTENT_CHILD_TYPE,$segment),$contentChildIdentifierRow=getFieldRow(SELECTORS_CONTENT_CHILD_IDENTIFIER,$segment),$settingNameRow=getFieldRow(SELECTORS_SETTING_NAME,$segment),$settingOperatorRow=getFieldRow(SELECTORS_SETTING_OPERATOR,$segment),$settingExpectedValueRow=getFieldRow(SELECTORS_SETTING_EXPECTED_VALUE,$segment);"HAS_CONTENT"===checkType||"NOT_HAS_CONTENT"===checkType?($contentChildTypeRow.show(),$contentChildIdentifierRow.show(),$settingNameRow.hide(),$settingOperatorRow.hide(),$settingExpectedValueRow.hide()):"HAS_SETTING"===checkType||"NOT_HAS_SETTING"===checkType?($contentChildTypeRow.hide(),$contentChildIdentifierRow.hide(),$settingNameRow.show(),$settingOperatorRow.show(),$settingExpectedValueRow.show()):($contentChildTypeRow.hide(),$contentChildIdentifierRow.hide(),$settingNameRow.hide(),$settingOperatorRow.hide(),$settingExpectedValueRow.hide())},toggleActionFields=function(actionWrapper){var $action=$(actionWrapper),actionType=getField(SELECTORS_ACTION_TYPE,$action).val(),$changeSettingNameRow=getFieldRow(SELECTORS_ACTION_CHANGE_SETTING_NAME,$action),$changeSettingNewValueRow=getFieldRow(SELECTORS_ACTION_CHANGE_SETTING_NEW_VALUE,$action),$addContentChildTypeRow=getFieldRow(SELECTORS_ACTION_ADD_CONTENT_CHILD_TYPE,$action),$addContentChildIdentifierRow=getFieldRow(SELECTORS_ACTION_ADD_CONTENT_CHILD_IDENTIFIER,$action),$addContentInitialSettingsRow=getFieldRow(SELECTORS_ACTION_ADD_CONTENT_INITIAL_SETTINGS,$action);"CHANGE_SETTING"===actionType?($changeSettingNameRow.show(),$changeSettingNewValueRow.show(),$addContentChildTypeRow.hide(),$addContentChildIdentifierRow.hide(),$addContentInitialSettingsRow.hide()):"ADD_CONTENT"===actionType?($changeSettingNameRow.hide(),$changeSettingNewValueRow.hide(),$addContentChildTypeRow.show(),$addContentChildIdentifierRow.show(),$addContentInitialSettingsRow.show()):($changeSettingNameRow.hide(),$changeSettingNewValueRow.hide(),$addContentChildTypeRow.hide(),$addContentChildIdentifierRow.hide(),$addContentInitialSettingsRow.hide())},addConditionChain=function(){log.debug("Attempting to add condition chain");var $lastChain=form.find(".conditionchain-wrapper").last();if($lastChain.length){var $newChain=$lastChain.clone();$newChain.find('input[type="text"], textarea').val(""),$newChain.find("select").prop("selectedIndex",0),$newChain.find(SELECTORS_SEGMENT_WRAPPER).not(":first").remove(),$newChain.insertAfter($lastChain),toggleSegmentFields($newChain.find(SELECTORS_SEGMENT_WRAPPER).first()),log.debug("New chain cloned (NEEDS ID/NAME UPDATES)")}else log.error("Could not find last chain wrapper")},addFailureAction=function(){log.debug("Attempting to add failure action");var $lastAction=form.find(SELECTORS_ACTION_WRAPPER).last();if($lastAction.length){var $newAction=$lastAction.clone();$newAction.find('input[type="text"], textarea').val(""),$newAction.find("select").prop("selectedIndex",0),$newAction.insertAfter($lastAction),toggleActionFields($newAction),log.debug("New action cloned (NEEDS ID/NAME UPDATES)")}else log.error("Could not find last action wrapper")};return{init:function(){log.debug("block_course_audit/rule_form: Initializing"),(form=$('input[name="rulename"]').closest("form")).length?(toggleRuleSetFields(),form.find(SELECTORS_SEGMENT_WRAPPER).each((function(){toggleSegmentFields(this)})),form.find(SELECTORS_ACTION_WRAPPER).each((function(){toggleActionFields(this)})),form.on("change",SELECTORS_RULE_SET_ID,toggleRuleSetFields),form.on("change",SELECTORS_TARGET_TYPE,(function(){toggleSegmentFields($(this).closest(SELECTORS_SEGMENT_WRAPPER))})),form.on("change",SELECTORS_CHECK_TYPE,(function(){toggleSegmentFields($(this).closest(SELECTORS_SEGMENT_WRAPPER))})),form.on("change",SELECTORS_ACTION_TYPE,(function(){toggleActionFields($(this).closest(SELECTORS_ACTION_WRAPPER))})),form.on("click",SELECTORS_ADD_SEGMENT_BUTTON_PREFIX+"_0",(function(){!function(chainId){log.debug("Attempting to add condition segment to chain: "+chainId);var $lastSegment=form.find("#conditionchain_"+chainId+"_wrapper "+SELECTORS_SEGMENT_WRAPPER).last();if($lastSegment.length){var $newSegment=$lastSegment.clone();$newSegment.find('input[type="text"], textarea').val(""),$newSegment.find("select").prop("selectedIndex",0),$newSegment.insertAfter($lastSegment),toggleSegmentFields($newSegment),log.debug("New segment cloned (NEEDS ID/NAME UPDATES)")}else log.error("Could not find last segment for chain "+chainId)}(0)})),form.on("click",SELECTORS_ADD_CHAIN_BUTTON,addConditionChain),form.on("click",SELECTORS_ADD_ACTION_BUTTON,addFailureAction),log.debug("block_course_audit/rule_form: Initialization complete.")):log.error("block_course_audit/rule_form: Could not find the Moodle form.")}}}));

//# sourceMappingURL=rule_form.min.js.map