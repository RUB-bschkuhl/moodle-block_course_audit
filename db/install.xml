<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="blocks/course_audit/db" VERSION="20240315" COMMENT="XMLDB file for Moodle blocks/course_audit"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd">
    <TABLES>
        <TABLE NAME="block_course_audit_tours" COMMENT="Stores references to tours created by the Course Audit block">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="Primary key"/>
                <FIELD NAME="tourid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="ID of the tour in tool_usertours_tours table"/>
                <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="ID of the course this tour belongs to"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when the tour was created"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when the tour was last modified"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="tourid" TYPE="foreign" FIELDS="tourid" REFTABLE="tool_usertours_tours" REFFIELDS="id"/>
                <KEY NAME="courseid" TYPE="foreign" FIELDS="courseid" REFTABLE="course" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="courseid" UNIQUE="false" FIELDS="courseid"/>
            </INDEXES>
        </TABLE>
        <TABLE NAME="block_course_audit_results" COMMENT="Stores results of individual audit rule checks for a specific audit run (tour)">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="Primary key"/>
                <FIELD NAME="auditid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="ID of the corresponding audit run in block_course_audit_tours"/>
                <FIELD NAME="rulekey" TYPE="char" LENGTH="100" NOTNULL="true" COMMENT="Unique identifier for the audit rule checked"/>
                <FIELD NAME="rulecategory" TYPE="char" LENGTH="50" NOTNULL="true" DEFAULT="general" COMMENT="Category of the rule (e.g., hint, action)"/>
                <FIELD NAME="status" TYPE="char" LENGTH="10" NOTNULL="true" COMMENT="Outcome of the rule check (e.g., pass, fail, info)"/>
                <FIELD NAME="messages" TYPE="text" NOTNULL="false" COMMENT="Optional message or details about the result"/>
                <FIELD NAME="targettype" TYPE="char" LENGTH="50" NOTNULL="false" COMMENT="Type of Moodle entity the rule targets (e.g., course, section, module)"/>
                <FIELD NAME="targetid" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="ID of the Moodle entity the rule targets"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when this result was recorded"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="auditid" TYPE="foreign" FIELDS="auditid" REFTABLE="block_course_audit_tours" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
        <TABLE NAME="block_course_audit_rule_coll" COMMENT="Stores collections or groups of rules.">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="collection_name" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="createdby" TYPE="int" LENGTH="10" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_createdby" TYPE="foreign" FIELDS="createdby" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
        <TABLE NAME="block_course_audit_rule" COMMENT="Defines a single, named rule with a description.">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="rule_name" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="rule_description" TYPE="text" NOTNULL="false"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="createdby" TYPE="int" LENGTH="10" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_createdby" TYPE="foreign" FIELDS="createdby" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
        <TABLE NAME="block_course_audit_coll_rule" COMMENT="Maps rules to rule collections (many-to-many).">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="rule_collection_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="rule_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_rule_collection_id" TYPE="foreign" FIELDS="rule_collection_id" REFTABLE="block_course_audit_rule_coll" REFFIELDS="id"/>
                <KEY NAME="fk_rule_id" TYPE="foreign" FIELDS="rule_id" REFTABLE="block_course_audit_rule" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
        <TABLE NAME="block_course_audit_check" COMMENT="Defines a single check condition within a rule.">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="rule_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="next_logic" TYPE="char" LENGTH="3" NOTNULL="false" COMMENT="Logic (AND/OR) connecting to the next check."/>
                <FIELD NAME="sort_order" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="scope" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="not_check" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" COMMENT="Boolean flag to invert the check."/>
                <FIELD NAME="source" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="check_type" TYPE="char" LENGTH="10" NOTNULL="true" COMMENT="E.g., SETTING, CONTENT"/>
                <FIELD NAME="target" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="comp" TYPE="char" LENGTH="20" NOTNULL="true" COMMENT="Comparison operator, e.g., equals, contains"/>
                <FIELD NAME="value" TYPE="text" NOTNULL="false"/>
                <FIELD NAME="value_type" TYPE="char" LENGTH="10" NOTNULL="false" COMMENT="E.g., bool, text, int"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_rule_id" TYPE="foreign" FIELDS="rule_id" REFTABLE="block_course_audit_rule" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
        <TABLE NAME="block_course_audit_resolution" COMMENT="Defines a resolution (hint or action) for a rule.">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="rule_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="scope" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="type" TYPE="char" LENGTH="10" NOTNULL="true" COMMENT="E.g., HINT, ACTION"/>
                <FIELD NAME="actiontype" TYPE="char" LENGTH="20" NOTNULL="false" COMMENT="E.g., ChangeSetting, AddContent"/>
                <FIELD NAME="settingorcontent" TYPE="text" NOTNULL="false" COMMENT="The setting or content to act upon."/>
                <FIELD NAME="value" TYPE="text" NOTNULL="false" COMMENT="The value to use in the action."/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_rule_id" TYPE="foreign" FIELDS="rule_id" REFTABLE="block_course_audit_rule" REFFIELDS="id"/>
            </KEYS>
        </TABLE>
    </TABLES>
</XMLDB>